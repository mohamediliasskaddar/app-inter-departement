<!-- users-list.component.html -->
<div class="container mt-4">

  <h2>Users Management</h2>

  <div *ngIf="isLoading" class="alert alert-info">
    Loading users...
  </div>

  <div *ngIf="error" class="alert alert-danger">
    {{ error }}
  </div>

  <div class="mb-3 d-flex gap-3">
  <div>
    <label for="roleFilter">Filter by Role:</label>
    <select id="roleFilter" class="form-control" [(ngModel)]="selectedRole">
      <option value="">All</option>
      <option *ngFor="let role of roles" [value]="role">{{ role }}</option>
    </select>
  </div>

  <div>
    <label for="departmentFilter">Filter by Department:</label>
    <select id="departmentFilter" class="form-control" [(ngModel)]="selectedDepartment">
      <option value="">All</option>
      <option *ngFor="let dept of departments" [value]="dept">{{ dept }}</option>
    </select>
  </div>
</div>

  <table class="table table-bordered table-striped" *ngIf="!isLoading && users.length > 0">
    <thead class="thead-dark">
      <tr>
        <th>Name</th>
        <th>Email</th>
        <th>Role</th>
        <th>Department</th>
        <th>Actions</th>
      </tr>
    </thead>
   <tbody>
  <tr *ngFor="let user of filteredUsers()">
    <!-- Name -->
    <td>
      <ng-container *ngIf="editingUserId !== user._id; else editName">
        {{ user.nom }}
      </ng-container>
      <ng-template #editName>
        <input type="text" [(ngModel)]="editValues.nom" class="form-control" />
      </ng-template>
    </td>

    <!-- Email -->
    <td>
      <ng-container *ngIf="editingUserId !== user._id; else editEmail">
        {{ user.email }}
      </ng-container>
      <ng-template #editEmail>
        <input type="email" [(ngModel)]="editValues.email" class="form-control" />
      </ng-template>
    </td>

    <!-- Role (not editable in your current setup) -->
    <td>{{ user.role }}</td>

    <!-- Department -->
    <td>
      <ng-container *ngIf="editingUserId !== user._id; else editDept">
        {{ user.departement }}
      </ng-container>
      <ng-template #editDept>
        <select [(ngModel)]="editValues.departement" class="form-control">
          <option *ngFor="let dept of departments" [value]="dept">{{ dept }}</option>
        </select>
      </ng-template>
    </td>

    <!-- Actions -->
    <td>
      <ng-container *ngIf="editingUserId === user._id; else viewActions">
        <button class="btn btn-sm btn-success me-1" (click)="saveUser(user._id)">Save</button>
        <button class="btn btn-sm btn-secondary" (click)="cancelEdit()">Cancel</button>
      </ng-container>
      <ng-template #viewActions>
        <button class="btn btn-sm btn-primary me-1" (click)="editUserInline(user)">✏️ Edit</button>
        <button class="btn btn-sm btn-danger" (click)="deleteUser(user._id)">🗑️ Delete</button>
      </ng-template>
    </td>
  </tr>
</tbody>

  </table>

  <div *ngIf="!isLoading && users.length === 0" class="alert alert-warning">
    No users found.
  </div>

</div>
